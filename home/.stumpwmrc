;;;;-*-Lisp-*-

(in-package :stumpwm)

(declaim (optimize (speed 3)
                   (debug 1)
                   (safety 0)))

(set-prefix-key (kbd "s-t"))
(setf *mouse-focus-policy* :sloppy)
(setf *frame-number-map* "1234567890")

(setq *terminal* "urxvt")
(defparameter +www-browser+ "chromium")

(define-key *root-map* (kbd "C-q") "quit")
(define-key *root-map* (kbd "C-r") "reload")

;;; Workspaces

(define-key *top-map* (kbd "s-1") "gselect web")
(define-key *top-map* (kbd "s-2") "gselect term")
(define-key *top-map* (kbd "s-3") "gselect edit")
(define-key *top-map* (kbd "s-4") "gselect im")
(define-key *top-map* (kbd "s-5") "gselect file")
(define-key *top-map* (kbd "s-6") "gselect mail")

;;; Commands

(defmacro com (name cmd keybinding &optional (class name))
  `(progn
     (defcommand ,name () ()
       (run-or-raise ,cmd '(:class ,(symbol-name class))))
     (define-key *top-map* (kbd ,keybinding) ,(symbol-name name))))

(com chromium +www-browser+ "C-s-c")
(com xchat "xchat" "C-s-x")
(com pidgin "pidgin" "C-s-i")
(com fm "pcmanfm" "C-s-f")
(com lock "xscreensaver-command -lock" "s-x")

(defcommand battery () ()
  "docstring"
  (message (run-shell-command "acpi")))

(defcommand open-selection-browser () ()
  "from http://www.mygooglest.com/fni/stumpwm.html
   Get the X selection and order the GUI browser to open it."
  (run-shell-command (concatenate 'string "exec " +www-browser+ " " (get-x-selection))))

(defcommand google (search)
  ((:string "Search in Google for: "))
  "ask the user for a search string and search for it in Google"
  (check-type search string)
  (substitute #\+ #\Space search)
  (run-shell-command (concatenate 'string "exec" +www-browser+ "http://www.google.com/search?q=" search)))

;;; Keybindings

(defcommand xlock () ()
  "docstring"
  (run-shell-command "exec xscreensaver-command -lock"))

(define-key *root-map* (kbd "b") "open-selection-browser")
(define-key *root-map* (kbd "g") "google")

;;; Theme

(set-fg-color "SteelBlue")
(set-bg-color "Black")
(set-border-color "Gray30")
(set-msg-border-width 0)
(setf *message-window-padding* 20)
(setf *maxsize-border-width* 0)
(setf *normal-border-width* 1)
(setf *window-border-style* :tight)
(set-focus-color "MidnightBlue")
(set-unfocus-color "Black")
(set-frame-outline-width 0)

;;; Group placement rules


#|(defmacro frame (group &rest apps)
  `(define-frame-preference ,group
     ,(loop for app in apps collecting
            `(0 nil t :class ,(symbol-name app)))))

(frame "web" :chromium)
(frame "edit" :emacs)
|#
;;; Autostart

(stumpwm::run-commands
 "gnew web"
 "gnew term"
 "gnew edit"
 "gnew im"
 "gnew file"
 "gnew mail"
 "gselect web"
 "exec bash .xinitrc")

(require 'swank)
(swank:create-server)
