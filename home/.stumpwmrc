;;;;-*-Lisp-*-

(in-package :stumpwm)

;;;; General options

(set-prefix-key (kbd "s-w"))
(setf *mouse-focus-policy* :sloppy)
(setf *frame-number-map* "123456789")

(setq +terminal+ "urxvt")
(defparameter +www-browser+ "firefox")

;;;; Workspaces

(define-key *top-map* (kbd "s-1") "gselect web")
(define-key *top-map* (kbd "s-2") "gselect term")
(define-key *top-map* (kbd "s-3") "gselect edit")
(define-key *top-map* (kbd "s-4") "gselect im")
(define-key *top-map* (kbd "s-5") "gselect file")
(define-key *top-map* (kbd "s-6") "gselect mail")

;;;; Commands

;;; Applications

(defcommand emacs () ()
  (run-or-raise "sh .scripts/start-emacs.sh" '(:class "emacs")))

(defcommand browser () ()
  (run-or-raise +www-browser+ '(:class "browser")))

(defcommand tor-browser () ()
  (run-or-raise "tor-browser-en" '(:class "tor-browser")))

(defcommand torrent () ()
  (run-or-raise "transmission-gtk" '(:class "torrent")))

(defcommand library () ()
  (run-or-raise "calibre" '(:class "library")))

(defcommand im () ()
  (run-or-raise "pidgin" '(:class "im")))

(defcommand music () ()
  (run-or-raise "audacious" '(:class "music")))

(defcommand fm () ()
  (run-or-raise "pcmanfm" '(:class "fm")))

(defcommand terminal () ()
  (run-or-raise +terminal+ '(:class "term")))

;;; System

(defcommand screensaver () ()
  (run-or-raise "xscreensaver-command -lock" '(:class "screensaver")))

(defcommand battery () ()
  "docstring"
  (message "~A" (run-shell-command "acpi" t)))

(defcommand uptime () ()
  "Display the system uptime"
  (message "~A" (run-shell-command "uptime" t)))

(defcommand open-selection-browser () ()
  "from http://www.mygooglest.com/fni/stumpwm.html
   Get the X selection and order the GUI browser to open it."
  (run-shell-command (concatenate 'string
                                  +www-browser+
                                  " \""
                                  (get-x-selection)
                                  "\"")))

;;; Keybindings

;; Remove some keybindings

(undefine-key *root-map* (kbd "F1"))
(undefine-key *root-map* (kbd "F2"))
(undefine-key *root-map* (kbd "F3"))
(undefine-key *root-map* (kbd "F4"))
(undefine-key *root-map* (kbd "F5"))
(undefine-key *root-map* (kbd "F6"))
(undefine-key *root-map* (kbd "F7"))
(undefine-key *root-map* (kbd "F8"))
(undefine-key *root-map* (kbd "F9"))
(undefine-key *root-map* (kbd "F10"))

(undefine-key *root-map* (kbd "e")) ; Emacs
(undefine-key *root-map* (kbd "k")) ; Kill
(undefine-key *root-map* (kbd "c")) ; Console
(undefine-key *root-map* (kbd "!")) ; Run shell command

; Repeat bindings
(undefine-key *root-map* (kbd "C-c"))
(undefine-key *root-map* (kbd "C-b"))
(undefine-key *root-map* (kbd "C-a"))

(define-key *root-map* (kbd "e") "emacs")

(define-key *top-map* (kbd "C-s-w") "browser")
(define-key *top-map* (kbd "C-s-o") "tor-browser")
(define-key *top-map* (kbd "C-s-t") "torrent")
(define-key *top-map* (kbd "C-s-b") "library")
(define-key *top-map* (kbd "C-s-i") "im")
(define-key *top-map* (kbd "C-s-m") "music")
(define-key *top-map* (kbd "C-s-f") "fm")

(define-key *top-map* (kbd "s-x") "screensaver")
(define-key *top-map* (kbd "s-q") "delete")
(define-key *top-map* (kbd "s-c") "terminal")
(define-key *top-map* (kbd "s-r") "exec")

; Take a screenshot

(define-key *root-map* (kbd "Print") "exec scrot")

;;;; Notifications

(defun echo-urgent-window (target)
  (message "Attention: ~A" (window-title target)))

(add-hook *urgent-window-hook* 'echo-urgent-window)

;;;; Theme

(set-fg-color "SteelBlue")
(set-bg-color "Black")
(set-border-color "Gray30")
(set-msg-border-width 0)
(setf *message-window-padding* 20)
(setf *maxsize-border-width* 0)
(setf *normal-border-width* 1)
(setf *window-border-style* :tight)
(set-focus-color "MidnightBlue")
(set-unfocus-color "Black")
(set-frame-outline-width 0)


;; theme
;; e5d7a1 : dark yellow
;; ad3208 : red

;;;; Autostart

(stumpwm::run-commands
 "gnew web"
 "gnew term"
 "gnew edit"
 "gnew im"
 "gnew file"
 "gnew mail"
 "gselect web")

;;;; Extras

(load ".wm/gaps")
